{
  "javascript_detail": "Y29uc3QgQkFTRV9VUkwgPSAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0mbGlzdD0nOwoKZnVuY3Rpb24gZ2V0dXJsKGlkKSB7CiAgICByZXR1cm4gewogICAgICAgIHVybDogQkFTRV9VUkwgKyBpZCwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChNYWNpbnRvc2g7IEludGVsIE1hYyBPUyBYIDEwXzE1XzYpIEFwcGxlV2ViS2l0LzYwNS4xLjE1IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi8xNC4wLjMgU2FmYXJpLzYwNS4xLjE1JwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gZ2V0VmlkZW9IVE1MUGFnZShib2R5KSB7CiAgICBsZXQgZGF0YSA9IGZpbmRKU09OKCdkZXRhaWwuaHRtbCcsICdkZXRhaWxfcmVzcG9uc2UnLCBib2R5LCAvXGJ5dEluaXRpYWxEYXRhXHMqPVxzKnsvLCAnPC9zY3JpcHQ+JywgJ3snKTsKICAgIGxldCBqc29uID0gZ2V0U2VhcmNoSnNvbihkYXRhKQogICAgcmV0dXJuIGpzb24KfQoKZnVuY3Rpb24gZmluZEpTT04oc291cmNlLCB2YXJOYW1lLCBib2R5LCBsZWZ0LCByaWdodCwgcHJlcGVuZEpTT04pIHsKICAgIGxldCBqc29uU3RyID0gYmV0d2Vlbihib2R5LCBsZWZ0LCByaWdodCk7CiAgICBpZiAoIWpzb25TdHIpIHsKICAgICAgICB0aHJvdyBFcnJvcihgQ291bGQgbm90IGZpbmQgJHt2YXJOYW1lfSBpbiAke3NvdXJjZX1gKTsKICAgIH0KICAgIHJldHVybiBwYXJzZUpTT04oc291cmNlLCB2YXJOYW1lLCBjdXRBZnRlckpTT04oYCR7cHJlcGVuZEpTT059JHtqc29uU3RyfWApKTsKfTsKCmJldHdlZW4gPSAoaGF5c3RhY2ssIGxlZnQsIHJpZ2h0KSA9PiB7CiAgICBsZXQgcG9zOwogICAgaWYgKGxlZnQgaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgICBjb25zdCBtYXRjaCA9IGhheXN0YWNrLm1hdGNoKGxlZnQpOwogICAgICAgIGlmICghbWF0Y2gpIHsgcmV0dXJuICcnOyB9CiAgICAgICAgcG9zID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICAgIHBvcyA9IGhheXN0YWNrLmluZGV4T2YobGVmdCk7CiAgICAgICAgaWYgKHBvcyA9PT0gLTEpIHsgcmV0dXJuICcnOyB9CiAgICAgICAgcG9zICs9IGxlZnQubGVuZ3RoOwogICAgfQogICAgaGF5c3RhY2sgPSBoYXlzdGFjay5zbGljZShwb3MpOwogICAgcG9zID0gaGF5c3RhY2suaW5kZXhPZihyaWdodCk7CiAgICBpZiAocG9zID09PSAtMSkgeyByZXR1cm4gJyc7IH0KICAgIGhheXN0YWNrID0gaGF5c3RhY2suc2xpY2UoMCwgcG9zKTsKICAgIHJldHVybiBoYXlzdGFjazsKfTsKCmN1dEFmdGVySlNPTiA9IG1peGVkSnNvbiA9PiB7CiAgICBsZXQgb3BlbiwgY2xvc2U7CiAgICBpZiAobWl4ZWRKc29uWzBdID09PSAnWycpIHsKICAgICAgICBvcGVuID0gJ1snOwogICAgICAgIGNsb3NlID0gJ10nOwogICAgfSBlbHNlIGlmIChtaXhlZEpzb25bMF0gPT09ICd7JykgewogICAgICAgIG9wZW4gPSAneyc7CiAgICAgICAgY2xvc2UgPSAnfSc7CiAgICB9CgogICAgaWYgKCFvcGVuKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW4ndCBjdXQgdW5zdXBwb3J0ZWQgSlNPTiAobmVlZCB0byBiZWdpbiB3aXRoIFsgb3IgeyApIGJ1dCBnb3Q6ICR7bWl4ZWRKc29uWzBdfWApOwogICAgfQoKICAgIC8vIFN0YXRlcyBpZiB0aGUgbG9vcCBpcyBjdXJyZW50bHkgaW4gYSBzdHJpbmcKICAgIGxldCBpc1N0cmluZyA9IGZhbHNlOwoKICAgIC8vIFN0YXRlcyBpZiB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaXMgdHJlYXRlZCBhcyBlc2NhcGVkIG9yIG5vdAogICAgbGV0IGlzRXNjYXBlZCA9IGZhbHNlOwoKICAgIC8vIEN1cnJlbnQgb3BlbiBicmFja2V0cyB0byBiZSBjbG9zZWQKICAgIGxldCBjb3VudGVyID0gMDsKCiAgICBsZXQgaTsKICAgIGZvciAoaSA9IDA7IGkgPCBtaXhlZEpzb24ubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBUb2dnbGUgdGhlIGlzU3RyaW5nIGJvb2xlYW4gd2hlbiBsZWF2aW5nL2VudGVyaW5nIHN0cmluZwogICAgICAgIGlmIChtaXhlZEpzb25baV0gPT09ICciJyAmJiAhaXNFc2NhcGVkKSB7CiAgICAgICAgICAgIGlzU3RyaW5nID0gIWlzU3RyaW5nOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIFRvZ2dsZSB0aGUgaXNFc2NhcGVkIGJvb2xlYW4gZm9yIGV2ZXJ5IGJhY2tzbGFzaAogICAgICAgIC8vIFJlc2V0IGZvciBldmVyeSByZWd1bGFyIGNoYXJhY3RlcgogICAgICAgIGlzRXNjYXBlZCA9IG1peGVkSnNvbltpXSA9PT0gJ1xcJyAmJiAhaXNFc2NhcGVkOwoKICAgICAgICBpZiAoaXNTdHJpbmcpIGNvbnRpbnVlOwoKICAgICAgICBpZiAobWl4ZWRKc29uW2ldID09PSBvcGVuKSB7CiAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICB9IGVsc2UgaWYgKG1peGVkSnNvbltpXSA9PT0gY2xvc2UpIHsKICAgICAgICAgICAgY291bnRlci0tOwogICAgICAgIH0KCiAgICAgICAgLy8gQWxsIGJyYWNrZXRzIGhhdmUgYmVlbiBjbG9zZWQsIHRodXMgZW5kIG9mIEpTT04gaXMgcmVhY2hlZAogICAgICAgIGlmIChjb3VudGVyID09PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgY3V0IEpTT04KICAgICAgICAgICAgcmV0dXJuIG1peGVkSnNvbi5zdWJzdHIoMCwgaSArIDEpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBXZSByYW4gdGhyb3VnaCB0aGUgd2hvbGUgc3RyaW5nIGFuZCBlbmRlZCB1cCB3aXRoIGFuIHVuY2xvc2VkIGJyYWNrZXQKICAgIHRocm93IEVycm9yKCJDYW4ndCBjdXQgdW5zdXBwb3J0ZWQgSlNPTiAobm8gbWF0Y2hpbmcgY2xvc2luZyBicmFja2V0IGZvdW5kKSIpOwp9OwoKY29uc3QganNvbkNsb3NpbmdDaGFycyA9IC9eWylcXX0nXHNdKy87CmZ1bmN0aW9uIHBhcnNlSlNPTihzb3VyY2UsIHZhck5hbWUsIGpzb24pIHsKICAgIGlmICghanNvbiB8fCB0eXBlb2YganNvbiA9PT0gJ29iamVjdCcpIHsKICAgICAgICByZXR1cm4ganNvbjsKICAgIH0gZWxzZSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAganNvbiA9IGpzb24ucmVwbGFjZShqc29uQ2xvc2luZ0NoYXJzLCAnJyk7CiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb24pOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICB0aHJvdyBFcnJvcihgRXJyb3IgcGFyc2luZyAke3Zhck5hbWV9IGluICR7c291cmNlfTogJHtlcnIubWVzc2FnZX1gKTsKICAgICAgICB9CiAgICB9Cn07CgpmdW5jdGlvbiBnZXRTZWFyY2hKc29uKGRhdGEpIHsKCiAgICBjb25zdCB2aWRlb3MgPSBkYXRhLmNvbnRlbnRzLnR3b0NvbHVtbldhdGNoTmV4dFJlc3VsdHMucGxheWxpc3QucGxheWxpc3QuY29udGVudHMKICAgIGxldCBqc29uRGF0YSA9IHRvanNvbih2aWRlb3MpCgogICAgY29uc29sZS5sb2coJy0tLS0tZG9uZSAtLS0tLS0tJywganNvbkRhdGEpCiAgICByZXR1cm4ganNvbkRhdGEKfQoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KZnVuY3Rpb24gdG9qc29uKGxpc3QpIHsKICAgIGNvbnN0IHJlc3VsdCA9IGxpc3QKICAgICAgICAubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHZpZGVvID0gdG9WaWRlbyhpdGVtKQogICAgICAgICAgICBpZiAodmlkZW8pIHsKICAgICAgICAgICAgICAgIHJldHVybiB2aWRlbwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuZmlsdGVyKChlKSA9PiBlKTsgLy8gcmVtb3ZlIG51bGwgdmFsdWVzCgogICAgY29uc3QganNvbkRhdGEgPSB7CiAgICAgICAgcmVzdWx0czogcmVzdWx0CiAgICB9CiAgICBjb25zb2xlLmxvZygnLS0tLS1kb25lIC0tLS0tLS0nKQogICAgcmV0dXJuIGpzb25EYXRhCn0KCmZ1bmN0aW9uIHRvVmlkZW8oaXRlbSkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIHBsYXlsaXN0UGFuZWxWaWRlb1JlbmRlcmVyOiB7CiAgICAgICAgICAgICAgICB0aXRsZSwKICAgICAgICAgICAgICAgIHNob3J0QnlsaW5lVGV4dDogeyBydW5zIH0sCiAgICAgICAgICAgICAgICB0aHVtYm5haWwsCiAgICAgICAgICAgICAgICB2aWRlb0lkLAogICAgICAgICAgICAgICAgbGVuZ3RoVGV4dDogeyBzaW1wbGVUZXh0OiB0aW1lIH0KICAgICAgICAgICAgfSwKICAgICAgICB9ID0gaXRlbTsKCiAgICAgICAgaWYgKHZpZGVvSWQgPT09ICc5eHAxWFdtSl9XbycpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6IDAsCiAgICAgICAgICAgIHRpdGxlOiB0aXRsZS5zaW1wbGVUZXh0LAogICAgICAgICAgICBkZXNjcmlwdGlvbjogcnVuc1swXSA/IHJ1bnNbMF0udGV4dCA6ICIiLAogICAgICAgICAgICBpbWFnZTogdGh1bWJuYWlsLnRodW1ibmFpbHMuc2xpY2UoLTEpWzBdLnVybCwKICAgICAgICAgICAgdmlkZW9JZCwKICAgICAgICAgICAgdGltZTogdGltZQogICAgICAgIH07CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgICByZXR1cm4gbnVsbAogICAgfQp9",
  "javascript_getlink": "Y29uc3QgQkFTRV9VUkwgPSAnaHR0cHM6Ly93d3cueW91dHViZS5jb20nOwoKbGV0IG5jb2RlRm47CgpmdW5jdGlvbiBnZXR1cmwoaWQpIHsKICAgIHJldHVybiB7CiAgICAgICAgdXJsOiBgJHtCQVNFX1VSTH0vd2F0Y2g/dj0ke2lkfSZhcHA9ZGVza3RvcGAsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNzQuMC4zNzI5LjE2OSBTYWZhcmkvNTM3LjM2JwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gZ2V0V2F0Y2hIVE1MUGFnZShib2R5KSB7CiAgICBsZXQgaW5mbyA9IHsgcGFnZTogJ3dhdGNoJyB9OwogICAgdHJ5IHsKICAgICAgICBpbmZvLnBsYXllcl9yZXNwb25zZSA9IGZpbmRKU09OKCd3YXRjaC5odG1sJywgJ3BsYXllcl9yZXNwb25zZScsCiAgICAgICAgICAgIGJvZHksIC9cYnl0SW5pdGlhbFBsYXllclJlc3BvbnNlXHMqPVxzKlx7L2ksICc8L3NjcmlwdD4nLCAneycpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgbGV0IGFyZ3MgPSBmaW5kSlNPTignd2F0Y2guaHRtbCcsICdwbGF5ZXJfcmVzcG9uc2UnLCBib2R5LCAvXGJ5dHBsYXllclwuY29uZmlnXHMqPVxzKnsvLCAnPC9zY3JpcHQ+JywgJ3snKTsKICAgICAgICBpbmZvLnBsYXllcl9yZXNwb25zZSA9IGZpbmRQbGF5ZXJSZXNwb25zZSgnd2F0Y2guaHRtbCcsIGFyZ3MpOwogICAgfQogICAgLy8gaW5mby5yZXNwb25zZSA9IGZpbmRKU09OKCd3YXRjaC5odG1sJywgJ3Jlc3BvbnNlJywgYm9keSwgL1xieXRJbml0aWFsRGF0YSgiXF0pP1xzKj1ccypcJy8sICInOyIsICcnKTsKICAgIGluZm8uaHRtbDVwbGF5ZXIgPSBnZXRIVE1MNXBsYXllcihib2R5KTsKICAgIHJldHVybiB7CiAgICAgICAgaHRtbDVwbGF5ZXI6IGluZm8uaHRtbDVwbGF5ZXIgPyBgJHtCQVNFX1VSTH0ke2luZm8uaHRtbDVwbGF5ZXJ9YCA6ICdodHRwczovL3d3dy55b3V0dWJlLmNvbS95dHMvanNiaW4vcGxheWVyLXZmbFVQSlFQRC9lbl9VUy9iYXNlLmpzJywKICAgICAgICBmb3JtYXRzOiBwYXJzZUZvcm1hdHMoaW5mby5wbGF5ZXJfcmVzcG9uc2UpCiAgICB9Owp9OwoKZnVuY3Rpb24gZmluZFBsYXllclJlc3BvbnNlKHNvdXJjZSwgaW5mbykgewogICAgY29uc3QgcGxheWVyX3Jlc3BvbnNlID0gaW5mbyAmJiAoCiAgICAgICAgKGluZm8uYXJncyAmJiBpbmZvLmFyZ3MucGxheWVyX3Jlc3BvbnNlKSB8fAogICAgICAgIGluZm8ucGxheWVyX3Jlc3BvbnNlIHx8IGluZm8ucGxheWVyUmVzcG9uc2UgfHwgaW5mby5lbWJlZGRlZF9wbGF5ZXJfcmVzcG9uc2UpOwogICAgcmV0dXJuIHBhcnNlSlNPTihzb3VyY2UsICdwbGF5ZXJfcmVzcG9uc2UnLCBwbGF5ZXJfcmVzcG9uc2UpOwp9OwoKZnVuY3Rpb24gZmluZEpTT04oc291cmNlLCB2YXJOYW1lLCBib2R5LCBsZWZ0LCByaWdodCwgcHJlcGVuZEpTT04pIHsKICAgIGxldCBqc29uU3RyID0gYmV0d2Vlbihib2R5LCBsZWZ0LCByaWdodCk7CiAgICBpZiAoIWpzb25TdHIpIHsKICAgICAgICB0aHJvdyBFcnJvcihgQ291bGQgbm90IGZpbmQgJHt2YXJOYW1lfSBpbiAke3NvdXJjZX1gKTsKICAgIH0KICAgIHJldHVybiBwYXJzZUpTT04oc291cmNlLCB2YXJOYW1lLCBjdXRBZnRlckpTT04oYCR7cHJlcGVuZEpTT059JHtqc29uU3RyfWApKTsKfTsKCmZ1bmN0aW9uIGdldEhUTUw1cGxheWVyKGJvZHkpIHsKICAgIGxldCBodG1sNXBsYXllclJlcyA9CiAgICAgICAgLzxzY3JpcHRccytzcmM9IihbXiJdKykiKD86XHMrdHlwZT0idGV4dFwvamF2YXNjcmlwdCIpP1xzK25hbWU9InBsYXllcl9pYXNcL2Jhc2UiXHMqPnwianNVcmwiOiIoW14iXSspIi8KICAgICAgICAgICAgLmV4ZWMoYm9keSk7CiAgICByZXR1cm4gaHRtbDVwbGF5ZXJSZXMgPyBodG1sNXBsYXllclJlc1sxXSB8fCBodG1sNXBsYXllclJlc1syXSA6IG51bGw7Cn07Cgpjb25zdCBqc29uQ2xvc2luZ0NoYXJzID0gL15bKVxdfSdcc10rLzsKZnVuY3Rpb24gcGFyc2VKU09OKHNvdXJjZSwgdmFyTmFtZSwganNvbikgewogICAgaWYgKCFqc29uIHx8IHR5cGVvZiBqc29uID09PSAnb2JqZWN0JykgewogICAgICAgIHJldHVybiBqc29uOwogICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBqc29uID0ganNvbi5yZXBsYWNlKGpzb25DbG9zaW5nQ2hhcnMsICcnKTsKICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoanNvbik7CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKGBFcnJvciBwYXJzaW5nICR7dmFyTmFtZX0gaW4gJHtzb3VyY2V9OiAke2Vyci5tZXNzYWdlfWApOwogICAgICAgIH0KICAgIH0KfTsKCmNvbnN0IHBhcnNlRm9ybWF0cyA9IHBsYXllcl9yZXNwb25zZSA9PiB7CiAgICBsZXQgZm9ybWF0cyA9IFtdOwogICAgaWYgKHBsYXllcl9yZXNwb25zZSAmJiBwbGF5ZXJfcmVzcG9uc2Uuc3RyZWFtaW5nRGF0YSkgewogICAgICAgIGZvcm1hdHMgPSBmb3JtYXRzCiAgICAgICAgICAgIC5jb25jYXQocGxheWVyX3Jlc3BvbnNlLnN0cmVhbWluZ0RhdGEuZm9ybWF0cyB8fCBbXSkKICAgICAgICAgICAgLmNvbmNhdChwbGF5ZXJfcmVzcG9uc2Uuc3RyZWFtaW5nRGF0YS5hZGFwdGl2ZUZvcm1hdHMgfHwgW10pOwogICAgfQogICAgcmV0dXJuIGZvcm1hdHM7Cn07CgpiZXR3ZWVuID0gKGhheXN0YWNrLCBsZWZ0LCByaWdodCkgPT4gewogICAgbGV0IHBvczsKICAgIGlmIChsZWZ0IGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgY29uc3QgbWF0Y2ggPSBoYXlzdGFjay5tYXRjaChsZWZ0KTsKICAgICAgICBpZiAoIW1hdGNoKSB7IHJldHVybiAnJzsgfQogICAgICAgIHBvcyA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgICBwb3MgPSBoYXlzdGFjay5pbmRleE9mKGxlZnQpOwogICAgICAgIGlmIChwb3MgPT09IC0xKSB7IHJldHVybiAnJzsgfQogICAgICAgIHBvcyArPSBsZWZ0Lmxlbmd0aDsKICAgIH0KICAgIGhheXN0YWNrID0gaGF5c3RhY2suc2xpY2UocG9zKTsKICAgIHBvcyA9IGhheXN0YWNrLmluZGV4T2YocmlnaHQpOwogICAgaWYgKHBvcyA9PT0gLTEpIHsgcmV0dXJuICcnOyB9CiAgICBoYXlzdGFjayA9IGhheXN0YWNrLnNsaWNlKDAsIHBvcyk7CiAgICByZXR1cm4gaGF5c3RhY2s7Cn07CgpjdXRBZnRlckpTT04gPSBtaXhlZEpzb24gPT4gewogICAgbGV0IG9wZW4sIGNsb3NlOwogICAgaWYgKG1peGVkSnNvblswXSA9PT0gJ1snKSB7CiAgICAgICAgb3BlbiA9ICdbJzsKICAgICAgICBjbG9zZSA9ICddJzsKICAgIH0gZWxzZSBpZiAobWl4ZWRKc29uWzBdID09PSAneycpIHsKICAgICAgICBvcGVuID0gJ3snOwogICAgICAgIGNsb3NlID0gJ30nOwogICAgfQoKICAgIGlmICghb3BlbikgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgY3V0IHVuc3VwcG9ydGVkIEpTT04gKG5lZWQgdG8gYmVnaW4gd2l0aCBbIG9yIHsgKSBidXQgZ290OiAke21peGVkSnNvblswXX1gKTsKICAgIH0KCiAgICAvLyBTdGF0ZXMgaWYgdGhlIGxvb3AgaXMgY3VycmVudGx5IGluIGEgc3RyaW5nCiAgICBsZXQgaXNTdHJpbmcgPSBmYWxzZTsKCiAgICAvLyBTdGF0ZXMgaWYgdGhlIGN1cnJlbnQgY2hhcmFjdGVyIGlzIHRyZWF0ZWQgYXMgZXNjYXBlZCBvciBub3QKICAgIGxldCBpc0VzY2FwZWQgPSBmYWxzZTsKCiAgICAvLyBDdXJyZW50IG9wZW4gYnJhY2tldHMgdG8gYmUgY2xvc2VkCiAgICBsZXQgY291bnRlciA9IDA7CgogICAgbGV0IGk7CiAgICBmb3IgKGkgPSAwOyBpIDwgbWl4ZWRKc29uLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8gVG9nZ2xlIHRoZSBpc1N0cmluZyBib29sZWFuIHdoZW4gbGVhdmluZy9lbnRlcmluZyBzdHJpbmcKICAgICAgICBpZiAobWl4ZWRKc29uW2ldID09PSAnIicgJiYgIWlzRXNjYXBlZCkgewogICAgICAgICAgICBpc1N0cmluZyA9ICFpc1N0cmluZzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyBUb2dnbGUgdGhlIGlzRXNjYXBlZCBib29sZWFuIGZvciBldmVyeSBiYWNrc2xhc2gKICAgICAgICAvLyBSZXNldCBmb3IgZXZlcnkgcmVndWxhciBjaGFyYWN0ZXIKICAgICAgICBpc0VzY2FwZWQgPSBtaXhlZEpzb25baV0gPT09ICdcXCcgJiYgIWlzRXNjYXBlZDsKCiAgICAgICAgaWYgKGlzU3RyaW5nKSBjb250aW51ZTsKCiAgICAgICAgaWYgKG1peGVkSnNvbltpXSA9PT0gb3BlbikgewogICAgICAgICAgICBjb3VudGVyKys7CiAgICAgICAgfSBlbHNlIGlmIChtaXhlZEpzb25baV0gPT09IGNsb3NlKSB7CiAgICAgICAgICAgIGNvdW50ZXItLTsKICAgICAgICB9CgogICAgICAgIC8vIEFsbCBicmFja2V0cyBoYXZlIGJlZW4gY2xvc2VkLCB0aHVzIGVuZCBvZiBKU09OIGlzIHJlYWNoZWQKICAgICAgICBpZiAoY291bnRlciA9PT0gMCkgewogICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGN1dCBKU09OCiAgICAgICAgICAgIHJldHVybiBtaXhlZEpzb24uc3Vic3RyKDAsIGkgKyAxKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gV2UgcmFuIHRocm91Z2ggdGhlIHdob2xlIHN0cmluZyBhbmQgZW5kZWQgdXAgd2l0aCBhbiB1bmNsb3NlZCBicmFja2V0CiAgICB0aHJvdyBFcnJvcigiQ2FuJ3QgY3V0IHVuc3VwcG9ydGVkIEpTT04gKG5vIG1hdGNoaW5nIGNsb3NpbmcgYnJhY2tldCBmb3VuZCkiKTsKfTsKCmZ1bmN0aW9uIGRlY2lwaGVyRm9ybWF0cyhmb3JtYXRzLCB0b2tlbnMpIHsKICAgIGxldCBkZWNpcGhlcmVkRm9ybWF0cyA9IHt9OwogICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGZvcm1hdHMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgY29uc3QgZm9ybWF0ID0gZm9ybWF0c1tpbmRleF07CiAgICAgICAgbGV0IGNpcGhlciA9IGZvcm1hdC5zaWduYXR1cmVDaXBoZXIgfHwgZm9ybWF0LmNpcGhlcjsKICAgICAgICBpZiAoY2lwaGVyKSB7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZm9ybWF0LCBwYXJzZShjaXBoZXIpKTsKICAgICAgICAgICAgZGVsZXRlIGZvcm1hdC5zaWduYXR1cmVDaXBoZXI7CiAgICAgICAgICAgIGRlbGV0ZSBmb3JtYXQuY2lwaGVyOwogICAgICAgIH0KICAgICAgICBpZiAoZm9ybWF0LnMpIHsKICAgICAgICAgICAgZm9ybWF0LnMgPSBmb3JtYXQucy5yZXBsYWNlKC9cJTNEL2csICc9Jyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHNpZyA9IHRva2VucyAmJiBmb3JtYXQucyA/IGRlY2lwaGVyKHRva2VucywgZm9ybWF0LnMpIDogbnVsbDsKICAgICAgICBmb3JtYXQudXJsID0gc2V0VVJMKGZvcm1hdCwgc2lnKTsKICAgICAgICAvL2N1dCBuCiAgICAgICAgbGV0IG5PbGQgPSBiZXR3ZWVuKGZvcm1hdC51cmwsJyZuPScsIiYiKQogICAgICAgIGxldCBuID0gbmNvZGVGbihuT2xkKQogICAgICAgIGZvcm1hdC51cmwgPSBmb3JtYXQudXJsLnJlcGxhY2UoYCZuPSR7bk9sZH0mYCxgJm49JHtufSZgKQogICAgICAgIGRlY2lwaGVyZWRGb3JtYXRzW2Zvcm1hdC5pdGFnXSA9IGZvcm1hdDsKICAgIH0KICAgIHJldHVybiBkZWNpcGhlcmVkRm9ybWF0czsKfTsKCgpjb25zdCBzZXRVUkwgPSAoZm9ybWF0LCBzaWcpID0+IHsKCiAgICBsZXQgZGVjb2RlZFVybDsKICAgIGlmIChmb3JtYXQudXJsKSB7CiAgICAgICAgZGVjb2RlZFVybCA9IGZvcm1hdC51cmw7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGRlY29kZWRVcmwgPSBkZWNvZGVVUklDb21wb25lbnQoZGVjb2RlZFVybCk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBjb25zb2xlLmxvZygic2V0VVJMIGVyciIsIGVycikKICAgICAgICByZXR1cm4gIiI7CiAgICB9CgogICAgaWYgKCFkZWNvZGVkVXJsLmluY2x1ZGVzKCcmcmF0ZWJ5cGFzcz0nKSkgewogICAgICAgIGRlY29kZWRVcmwgPSBkZWNvZGVkVXJsICsgJyZyYXRlYnlwYXNzPXllcyc7CiAgICB9CgogICAgaWYgKHNpZykgewogICAgICAgIC8vIFdoZW4gWW91VHViZSBwcm92aWRlcyBhIGBzcGAgcGFyYW1ldGVyIHRoZSBzaWduYXR1cmUgYHNpZ2AgbXVzdCBnbwogICAgICAgIC8vIGludG8gdGhlIHBhcmFtZXRlciBpdCBzcGVjaWZpZXMuCiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mZW50L25vZGUteXRkbC1jb3JlL2lzc3Vlcy80MTcKICAgICAgICBsZXQgc2lnbmF0dXJlID0gZm9ybWF0LnNwIHx8ICdzaWduYXR1cmUnCiAgICAgICAgZGVjb2RlZFVybCA9IGRlY29kZWRVcmwgKyBgJiR7c2lnbmF0dXJlfT0ke3NpZ31gOwogICAgfQoKICAgIHJldHVybiBkZWNvZGVkVXJsOwp9OwoKLyoqCiAgICogRGVjaXBoZXIgYSBzaWduYXR1cmUgYmFzZWQgb24gYWN0aW9uIHRva2Vucy4KICAgKgogICAqIEBwYXJhbSB7QXJyYXkuPHN0cmluZz59IHRva2VucwogICAqIEBwYXJhbSB7c3RyaW5nfSBzaWcKICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAqLwpmdW5jdGlvbiBkZWNpcGhlcih0b2tlbnMsIHNpZykgewogICAgc2lnID0gc2lnLnNwbGl0KCcnKTsKICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0b2tlbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBsZXQgdG9rZW4gPSB0b2tlbnNbaV0sIHBvczsKICAgICAgICBzd2l0Y2ggKHRva2VuWzBdKSB7CiAgICAgICAgICAgIGNhc2UgJ3InOgogICAgICAgICAgICAgICAgc2lnID0gc2lnLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICd3JzoKICAgICAgICAgICAgICAgIHBvcyA9IH5+dG9rZW4uc2xpY2UoMSk7CiAgICAgICAgICAgICAgICBzaWcgPSBzd2FwSGVhZEFuZFBvc2l0aW9uKHNpZywgcG9zKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzJzoKICAgICAgICAgICAgICAgIHBvcyA9IH5+dG9rZW4uc2xpY2UoMSk7CiAgICAgICAgICAgICAgICBzaWcgPSBzaWcuc2xpY2UocG9zKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdwJzoKICAgICAgICAgICAgICAgIHBvcyA9IH5+dG9rZW4uc2xpY2UoMSk7CiAgICAgICAgICAgICAgICBzaWcuc3BsaWNlKDAsIHBvcyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gc2lnLmpvaW4oJycpOwp9OwoKCi8qKgogKiBTd2FwcyB0aGUgZmlyc3QgZWxlbWVudCBvZiBhbiBhcnJheSB3aXRoIG9uZSBvZiBnaXZlbiBwb3NpdGlvbi4KICoKICogQHBhcmFtIHtBcnJheS48T2JqZWN0Pn0gYXJyCiAqIEBwYXJhbSB7bnVtYmVyfSBwb3NpdGlvbgogKiBAcmV0dXJucyB7QXJyYXkuPE9iamVjdD59CiAqLwpzd2FwSGVhZEFuZFBvc2l0aW9uID0gKGFyciwgcG9zaXRpb24pID0+IHsKICAgIGNvbnN0IGZpcnN0ID0gYXJyWzBdOwogICAgYXJyWzBdID0gYXJyW3Bvc2l0aW9uICUgYXJyLmxlbmd0aF07CiAgICBhcnJbcG9zaXRpb25dID0gZmlyc3Q7CiAgICByZXR1cm4gYXJyOwp9OwoKCmNvbnN0IGpzVmFyU3RyID0gJ1thLXpBLVpfXFwkXVthLXpBLVpfMC05XSonOwpjb25zdCBqc1NpbmdsZVF1b3RlU3RyID0gYCdbXidcXFxcXSooOj9cXFxcW1xcc1xcU11bXidcXFxcXSopKidgOwpjb25zdCBqc0RvdWJsZVF1b3RlU3RyID0gYCJbXiJcXFxcXSooOj9cXFxcW1xcc1xcU11bXiJcXFxcXSopKiJgOwpjb25zdCBqc1F1b3RlU3RyID0gYCg/OiR7anNTaW5nbGVRdW90ZVN0cn18JHtqc0RvdWJsZVF1b3RlU3RyfSlgOwpjb25zdCBqc0tleVN0ciA9IGAoPzoke2pzVmFyU3RyfXwke2pzUXVvdGVTdHJ9KWA7CmNvbnN0IGpzUHJvcFN0ciA9IGAoPzpcXC4ke2pzVmFyU3RyfXxcXFske2pzUXVvdGVTdHJ9XFxdKWA7CmNvbnN0IGpzRW1wdHlTdHIgPSBgKD86Jyd8IiIpYDsKY29uc3QgcmV2ZXJzZVN0ciA9ICc6ZnVuY3Rpb25cXChhXFwpXFx7JyArCiAgICAnKD86cmV0dXJuICk/YVxcLnJldmVyc2VcXChcXCknICsKICAgICdcXH0nOwpjb25zdCBzbGljZVN0ciA9ICc6ZnVuY3Rpb25cXChhLGJcXClcXHsnICsKICAgICdyZXR1cm4gYVxcLnNsaWNlXFwoYlxcKScgKwogICAgJ1xcfSc7CmNvbnN0IHNwbGljZVN0ciA9ICc6ZnVuY3Rpb25cXChhLGJcXClcXHsnICsKICAgICdhXFwuc3BsaWNlXFwoMCxiXFwpJyArCiAgICAnXFx9JzsKY29uc3Qgc3dhcFN0ciA9ICc6ZnVuY3Rpb25cXChhLGJcXClcXHsnICsKICAgICd2YXIgYz1hXFxbMFxcXTthXFxbMFxcXT1hXFxbYig/OiVhXFwubGVuZ3RoKT9cXF07YVxcW2IoPzolYVxcLmxlbmd0aCk/XFxdPWMoPzo7cmV0dXJuIGEpPycgKwogICAgJ1xcfSc7CmNvbnN0IGFjdGlvbnNPYmpSZWdleHAgPSBuZXcgUmVnRXhwKAogICAgYHZhciAoJHtqc1ZhclN0cn0pPVxceygoPzooPzoke2pzS2V5U3RyfSR7cmV2ZXJzZVN0cn18JHtqc0tleVN0cn0ke3NsaWNlU3RyfXwke2pzS2V5U3RyfSR7c3BsaWNlU3RyfXwke2pzS2V5U3RyfSR7c3dhcFN0cgogICAgfSksP1xccj9cXG4/KSspXFx9O2ApOwpjb25zdCBhY3Rpb25zRnVuY1JlZ2V4cCA9IG5ldyBSZWdFeHAoYCR7YGZ1bmN0aW9uKD86ICR7anNWYXJTdHJ9KT9cXChhXFwpXFx7YCArCiAgICBgYT1hXFwuc3BsaXRcXCgke2pzRW1wdHlTdHJ9XFwpO1xccypgICsKICAgIGAoKD86KD86YT0pPyR7anNWYXJTdHJ9YH0ke2pzUHJvcFN0cgogICAgfVxcKGEsXFxkK1xcKTspKylgICsKICAgIGByZXR1cm4gYVxcLmpvaW5cXCgke2pzRW1wdHlTdHJ9XFwpYCArCiAgICBgXFx9YCk7CmNvbnN0IHJldmVyc2VSZWdleHAgPSBuZXcgUmVnRXhwKGAoPzpefCwpKCR7anNLZXlTdHJ9KSR7cmV2ZXJzZVN0cn1gLCAnbScpOwpjb25zdCBzbGljZVJlZ2V4cCA9IG5ldyBSZWdFeHAoYCg/Ol58LCkoJHtqc0tleVN0cn0pJHtzbGljZVN0cn1gLCAnbScpOwpjb25zdCBzcGxpY2VSZWdleHAgPSBuZXcgUmVnRXhwKGAoPzpefCwpKCR7anNLZXlTdHJ9KSR7c3BsaWNlU3RyfWAsICdtJyk7CmNvbnN0IHN3YXBSZWdleHAgPSBuZXcgUmVnRXhwKGAoPzpefCwpKCR7anNLZXlTdHJ9KSR7c3dhcFN0cn1gLCAnbScpOwoKCi8qKgogKiBFeHRyYWN0cyB0aGUgYWN0aW9ucyB0aGF0IHNob3VsZCBiZSB0YWtlbiB0byBkZWNpcGhlciBhIHNpZ25hdHVyZS4KICoKICogVGhpcyBzZWFyY2hlcyBmb3IgYSBmdW5jdGlvbiB0aGF0IHBlcmZvcm1zIHN0cmluZyBtYW5pcHVsYXRpb25zIG9uCiAqIHRoZSBzaWduYXR1cmUuIFdlIGFscmVhZHkga25vdyB3aGF0IHRoZSAzIHBvc3NpYmxlIGNoYW5nZXMgdG8gYSBzaWduYXR1cmUKICogYXJlIGluIG9yZGVyIHRvIGRlY2lwaGVyIGl0LiBUaGVyZSBpcwogKgogKiAqIFJldmVyc2luZyB0aGUgc3RyaW5nLgogKiAqIFJlbW92aW5nIGEgbnVtYmVyIG9mIGNoYXJhY3RlcnMgZnJvbSB0aGUgYmVnaW5uaW5nLgogKiAqIFN3YXBwaW5nIHRoZSBmaXJzdCBjaGFyYWN0ZXIgd2l0aCBhbm90aGVyIHBvc2l0aW9uLgogKgogKiBOb3RlLCBgQXJyYXkjc2xpY2UoKWAgdXNlZCB0byBiZSB1c2VkIGluc3RlYWQgb2YgYEFycmF5I3NwbGljZSgpYCwKICogaXQncyBrZXB0IGluIGNhc2Ugd2UgZW5jb3VudGVyIGFueSBvbGRlciBodG1sNXBsYXllciBmaWxlcy4KICoKICogQWZ0ZXIgcmV0cmlldmluZyB0aGUgZnVuY3Rpb24gdGhhdCBkb2VzIHRoaXMsIHdlIGNhbiBzZWUgd2hhdCBhY3Rpb25zCiAqIGl0IHRha2VzIG9uIGEgc2lnbmF0dXJlLgogKgogKiBAcGFyYW0ge3N0cmluZ30gYm9keQogKiBAcmV0dXJucyB7QXJyYXkuPHN0cmluZz59CiAqLwpleHRyYWN0QWN0aW9ucyA9IGJvZHkgPT4gewogICAgZ2V0bihib2R5KQogICAgY29uc3Qgb2JqUmVzdWx0ID0gYWN0aW9uc09ialJlZ2V4cC5leGVjKGJvZHkpOwogICAgY29uc3QgZnVuY1Jlc3VsdCA9IGFjdGlvbnNGdW5jUmVnZXhwLmV4ZWMoYm9keSk7CiAgICBpZiAoIW9ialJlc3VsdCB8fCAhZnVuY1Jlc3VsdCkgeyByZXR1cm4gbnVsbDsgfQoKICAgIGNvbnN0IG9iaiA9IG9ialJlc3VsdFsxXS5yZXBsYWNlKC9cJC9nLCAnXFwkJyk7CiAgICBjb25zdCBvYmpCb2R5ID0gb2JqUmVzdWx0WzJdLnJlcGxhY2UoL1wkL2csICdcXCQnKTsKICAgIGNvbnN0IGZ1bmNCb2R5ID0gZnVuY1Jlc3VsdFsxXS5yZXBsYWNlKC9cJC9nLCAnXFwkJyk7CgogICAgbGV0IHJlc3VsdCA9IHJldmVyc2VSZWdleHAuZXhlYyhvYmpCb2R5KTsKICAgIGNvbnN0IHJldmVyc2VLZXkgPSByZXN1bHQgJiYgcmVzdWx0WzFdCiAgICAgICAgLnJlcGxhY2UoL1wkL2csICdcXCQnKQogICAgICAgIC5yZXBsYWNlKC9cJHxeJ3xeInwnJHwiJC9nLCAnJyk7CiAgICByZXN1bHQgPSBzbGljZVJlZ2V4cC5leGVjKG9iakJvZHkpOwogICAgY29uc3Qgc2xpY2VLZXkgPSByZXN1bHQgJiYgcmVzdWx0WzFdCiAgICAgICAgLnJlcGxhY2UoL1wkL2csICdcXCQnKQogICAgICAgIC5yZXBsYWNlKC9cJHxeJ3xeInwnJHwiJC9nLCAnJyk7CiAgICByZXN1bHQgPSBzcGxpY2VSZWdleHAuZXhlYyhvYmpCb2R5KTsKICAgIGNvbnN0IHNwbGljZUtleSA9IHJlc3VsdCAmJiByZXN1bHRbMV0KICAgICAgICAucmVwbGFjZSgvXCQvZywgJ1xcJCcpCiAgICAgICAgLnJlcGxhY2UoL1wkfF4nfF4ifCckfCIkL2csICcnKTsKICAgIHJlc3VsdCA9IHN3YXBSZWdleHAuZXhlYyhvYmpCb2R5KTsKICAgIGNvbnN0IHN3YXBLZXkgPSByZXN1bHQgJiYgcmVzdWx0WzFdCiAgICAgICAgLnJlcGxhY2UoL1wkL2csICdcXCQnKQogICAgICAgIC5yZXBsYWNlKC9cJHxeJ3xeInwnJHwiJC9nLCAnJyk7CgogICAgY29uc3Qga2V5cyA9IGAoJHtbcmV2ZXJzZUtleSwgc2xpY2VLZXksIHNwbGljZUtleSwgc3dhcEtleV0uam9pbignfCcpfSlgOwogICAgY29uc3QgbXlyZWcgPSBgKD86YT0pPyR7b2JqCiAgICAgICAgfSg/OlxcLiR7a2V5c318XFxbJyR7a2V5c30nXFxdfFxcWyIke2tleXN9IlxcXSlgICsKICAgICAgICBgXFwoYSwoXFxkKylcXClgOwogICAgY29uc3QgdG9rZW5pemVSZWdleHAgPSBuZXcgUmVnRXhwKG15cmVnLCAnZycpOwogICAgY29uc3QgdG9rZW5zID0gW107CiAgICB3aGlsZSAoKHJlc3VsdCA9IHRva2VuaXplUmVnZXhwLmV4ZWMoZnVuY0JvZHkpKSAhPT0gbnVsbCkgewogICAgICAgIGxldCBrZXkgPSByZXN1bHRbMV0gfHwgcmVzdWx0WzJdIHx8IHJlc3VsdFszXTsKICAgICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgICAgICBjYXNlIHN3YXBLZXk6CiAgICAgICAgICAgICAgICB0b2tlbnMucHVzaChgdyR7cmVzdWx0WzRdfWApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgcmV2ZXJzZUtleToKICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKCdyJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBzbGljZUtleToKICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKGBzJHtyZXN1bHRbNF19YCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBzcGxpY2VLZXk6CiAgICAgICAgICAgICAgICB0b2tlbnMucHVzaChgcCR7cmVzdWx0WzRdfWApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHRva2VuczsKfTsKCgovLy8vL3F1ZXJ5LXN0cmluZwpmdW5jdGlvbiBwYXJzZShxdWVyeSkgewoKICAgIGNvbnN0IGZvcm1hdHRlciA9IHBhcnNlckZvckFycmF5Rm9ybWF0KCk7CiAgICAvLyBDcmVhdGUgYW4gb2JqZWN0IHdpdGggbm8gcHJvdG90eXBlCiAgICBjb25zdCByZXQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgIGlmICh0eXBlb2YgcXVlcnkgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICBxdWVyeSA9IHF1ZXJ5LnRyaW0oKS5yZXBsYWNlKC9eWz8jJl0vLCAnJyk7CgogICAgaWYgKCFxdWVyeSkgewogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgZm9yIChjb25zdCBwYXJhbSBvZiBxdWVyeS5zcGxpdCgnJicpKSB7CiAgICAgICAgaWYgKHBhcmFtID09PSAnJykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSBzcGxpdE9uRmlyc3QocGFyYW0ucmVwbGFjZSgvXCsvZywgJyAnKSwgJz0nKTsKICAgICAgICBmb3JtYXR0ZXIoZGVjb2RlKGtleSksIHZhbHVlLCByZXQpOwogICAgfQoKICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHJldCkpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IHJldFtrZXldOwogICAgICAgIAogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgayBvZiBPYmplY3Qua2V5cyh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHZhbHVlW2tdID0gcGFyc2VWYWx1ZSh2YWx1ZVtrXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXRba2V5XSA9IHBhcnNlVmFsdWUodmFsdWUpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGRlY29kZSh2YWx1ZSkgewogICAgZW5jb2RlZFVSSSA9IHZhbHVlLnJlcGxhY2UoL1wrL2csICcgJyk7CiAgICBlbmNvZGVkVVJJID0gZW5jb2RlZFVSSS5yZXBsYWNlKC9cJTNEL2csICc9Jyk7CgogICAgLy8gVHJ5IHRoZSBidWlsdCBpbiBkZWNvZGVyIGZpcnN0CiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVuY29kZWRVUkkpOwogICAgLy8gICAgICByZXR1cm4gZGVjb2RlQ29tcG9uZW50KHZhbHVlKTsKfQoKZnVuY3Rpb24gc3BsaXRPbkZpcnN0KHN0cmluZywgc2VwYXJhdG9yKSB7CiAgICBpZiAoISh0eXBlb2Ygc3RyaW5nID09PSAnc3RyaW5nJyAmJiB0eXBlb2Ygc2VwYXJhdG9yID09PSAnc3RyaW5nJykpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCB0aGUgYXJndW1lbnRzIHRvIGJlIG9mIHR5cGUgYHN0cmluZ2AnKTsKICAgIH0KCiAgICBpZiAoc3RyaW5nID09PSAnJyB8fCBzZXBhcmF0b3IgPT09ICcnKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIGNvbnN0IHNlcGFyYXRvckluZGV4ID0gc3RyaW5nLmluZGV4T2Yoc2VwYXJhdG9yKTsKCiAgICBpZiAoc2VwYXJhdG9ySW5kZXggPT09IC0xKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIHJldHVybiBbCiAgICAgICAgc3RyaW5nLnNsaWNlKDAsIHNlcGFyYXRvckluZGV4KSwKICAgICAgICBzdHJpbmcuc2xpY2Uoc2VwYXJhdG9ySW5kZXggKyBzZXBhcmF0b3IubGVuZ3RoKQogICAgXTsKfQoKCmZ1bmN0aW9uIHBhcnNlVmFsdWUodmFsdWUpIHsKICAgIGlmICghTnVtYmVyLmlzTmFOKE51bWJlcih2YWx1ZSkpICYmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLnRyaW0oKSAhPT0gJycpKSB7CiAgICAgICAgdmFsdWUgPSBOdW1iZXIodmFsdWUpOwogICAgfSBlbHNlIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiAodmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnIHx8IHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICdmYWxzZScpKSB7CiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZSc7CiAgICB9CgogICAgcmV0dXJuIHZhbHVlOwp9CgoKZnVuY3Rpb24gcGFyc2VyRm9yQXJyYXlGb3JtYXQoKSB7CiAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7CiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gdmFsdWU7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbXS5jb25jYXQoYWNjdW11bGF0b3Jba2V5XSwgdmFsdWUpOwogICAgfTsKfQoKZnVuY3Rpb24gcGluY2goYm9keSxzdGFydCxlbmQsc25pcCxlbmlwLGVtcHR5LHRydW5jYXRlKSB7CiAgICBsZXQgZXh0cmFjdCA9IGVtcHR5OwogICAgbGV0IHNwb3MgPSBib2R5LmluZGV4T2Yoc3RhcnQpOwogICAgbGV0IHNsZW4gPSBzdGFydC5sZW5ndGg7CiAgICBpZiAoc3Bvcz49MCkgewogICAgICAgIGxldCBuZXh0ID0gYm9keS5zdWJzdHIoc3BvcytzbGVuLXNuaXApOwogICAgICAgIGxldCBlcG9zID0gbmV4dC5pbmRleE9mKGVuZCk7CiAgICAgICAgaWYgKGVwb3M+PTApIHsKICAgICAgICAgICAgZXh0cmFjdCA9IG5leHQuc3Vic3RyKDAsZXBvcytlbmlwKTsKICAgICAgICAgICAgaWYgKHRydW5jYXRlKSBib2R5ID0gYm9keS5zdWJzdHIoc3BvcytzbGVuLXNuaXArZXBvcytlbmlwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBleHRyYWN0ID0gYm9keS5zdWJzdHIoc3BvcytzbGVuLXNuaXApOwogICAgICAgICAgICBpZiAodHJ1bmNhdGUpIGJvZHkgPSAnJzsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGlmICh0cnVuY2F0ZSkgYm9keSA9ICcnOwogICAgfQogICAgcmV0dXJuIGV4dHJhY3Q7Cn0KCmZ1bmN0aW9uIGJsb2NrKGJvZHksc3RhcnQsc25pcCxvcGVuLGNsb3NlLGVtcHR5LHRydW5jYXRlKSB7CiAgICBsZXQgZXh0cmFjdCA9IGVtcHR5OwogICAgbGV0IHNwb3MgPSBib2R5LmluZGV4T2Yoc3RhcnQpOwogICAgbGV0IHNsZW4gPSBzdGFydC5sZW5ndGg7CiAgICBpZiAoc3Bvcz49MCkgewogICAgICAgIGxldCBwb3MgPSBzcG9zK3NsZW4tc25pcDsKICAgICAgICBsZXQgZG9uZSA9IGZhbHNlOwogICAgICAgIGxldCBsZXZlbCA9IDA7CiAgICAgICAgZXh0cmFjdCA9IHN0YXJ0LnN1YnN0cigwLHNsZW4tc25pcCk7CiAgICAgICAgd2hpbGUgKCFkb25lKSB7CiAgICAgICAgICAgIHN3aXRjaCAoYm9keVtwb3NdKSB7CiAgICAgICAgICAgICAgICBjYXNlIG9wZW4gOgogICAgICAgICAgICAgICAgICAgIGxldmVsKys7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGNsb3NlIDoKICAgICAgICAgICAgICAgICAgICBsZXZlbC0tOwogICAgICAgICAgICAgICAgICAgIGlmICghbGV2ZWwpIGRvbmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4dHJhY3QgKz0gYm9keVtwb3NdOwogICAgICAgICAgICBwb3MrKzsKICAgICAgICAgICAgaWYgKHBvcz49Ym9keS5sZW5ndGgpIGRvbmUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAodHJ1bmNhdGUpIGJvZHkgPSBib2R5LnN1YnN0cmluZygwLHBvcyk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICh0cnVuY2F0ZSkgYm9keSA9ICcnOwogICAgfQogICAgcmV0dXJuIGV4dHJhY3Q7Cn0KCmZ1bmN0aW9uIGdldG4oYm9keSkgewogICAgbGV0IGZuYW1lID0gcGluY2goYm9keSwnJiYoYj1hLmdldCgibiIpKSYmKGI9JywnKGIpJywwLDAsJycsZmFsc2UpOwogICAgbGV0IGZmdW5jID0gZm5hbWUrJz1mdW5jdGlvbihhKSc7CiAgICBmZnVuYyA9ICd2YXIgJysgYmxvY2soYm9keSxmZnVuYywwLCd7JywnfScsJ3t9JyxmYWxzZSk7CiAgICBuY29kZUZuID0gbmV3IEZ1bmN0aW9uKCduY29kZScsZmZ1bmMrJzsgcmV0dXJuICcrZm5hbWUrJyhuY29kZSk7Jyk7Cn0=",
  "javascript_upNext": "Y29uc3QgQkFTRV9VUkwgPSAnaHR0cHM6Ly93d3cueW91dHViZS5jb20nOwoKZnVuY3Rpb24gZ2V0dXJsKGlkKSB7CiAgICByZXR1cm4gewogICAgICAgIHVybDogYCR7QkFTRV9VUkx9L3dhdGNoP3Y9JHtpZH0mYXBwPWRlc2t0b3BgLAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiAnTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTVfNikgQXBwbGVXZWJLaXQvNjA1LjEuMTUgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzE0LjAuMyBTYWZhcmkvNjA1LjEuMTUnCiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBnZXRXYXRjaEhUTUxQYWdlKGJvZHkpIHsKICAgIGxldCBkYXRhID0gZmluZEpTT04oJ25leHQuaHRtbCcsICduZXh0X3Jlc3BvbnNlJywgYm9keSwgL1xieXRJbml0aWFsRGF0YVxzKj1ccyp7LywgJzwvc2NyaXB0PicsICd7Jyk7CiAgICByZXR1cm4gbmV4dFZpZGVvcyhkYXRhKQp9OwoKZnVuY3Rpb24gbmV4dFZpZGVvcyhkYXRhKSB7CiAgICB2YXIgY29udGVudHMKICAgIHRyeSB7CiAgICAgIGNvbnRlbnRzID0gZGF0YS5wbGF5ZXJPdmVybGF5cy5wbGF5ZXJPdmVybGF5UmVuZGVyZXIuZW5kU2NyZWVuLndhdGNoTmV4dEVuZFNjcmVlblJlbmRlcmVyLnJlc3VsdHM7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb250ZW50cyA9IGRhdGEuY29udGVudHMudHdvQ29sdW1uV2F0Y2hOZXh0UmVzdWx0cy5zZWNvbmRhcnlSZXN1bHRzLnNlY29uZGFyeVJlc3VsdHMucmVzdWx0cwogICAgfQogICAgCiAgICB2YXIgcmVzdWx0ID0gW10KCiAgICBjb250ZW50cy5mb3JFYWNoKGNvbnRlbnQgPT4gewogICAgICAgICAgbGV0IHZpZGVvID0gdG9WaWRlbyhjb250ZW50KQogICAgICAgICAgaWYgKHZpZGVvKSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZpZGVvKQogICAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0Cn0KCmZ1bmN0aW9uIHRvVmlkZW8oaXRlbSkgewogICAgdHJ5IHsKICAgICAgdmFyIHZpZGVvUmVuZGVyZXIgPSBpdGVtLmVuZFNjcmVlblZpZGVvUmVuZGVyZXIKICAgICAgaWYgKHZpZGVvUmVuZGVyZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHZpZGVvUmVuZGVyZXIgPSBpdGVtLmNvbXBhY3RWaWRlb1JlbmRlcmVyCiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIHRpdGxlLAogICAgICAgIHNob3J0QnlsaW5lVGV4dDogeyBydW5zIH0sCiAgICAgICAgdGh1bWJuYWlsLAogICAgICAgIHZpZGVvSWQsCiAgICAgICAgbGVuZ3RoVGV4dDogeyBzaW1wbGVUZXh0OiB0aW1lIH0KICAgICAgfSA9IHZpZGVvUmVuZGVyZXI7CiAgCiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICB0aXRsZTogdGl0bGUuc2ltcGxlVGV4dCwKICAgICAgICBkZXNjcmlwdGlvbjogcnVuc1swXSA/IHJ1bnNbMF0udGV4dCA6ICIiLAogICAgICAgIGltYWdlOiB0aHVtYm5haWwudGh1bWJuYWlscy5zbGljZSgtMSlbMF0udXJsLAogICAgICAgIHZpZGVvSWQsCiAgICAgICAgdGltZTogdGltZQogICAgICB9OwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5sb2coInRvVmlkZW8iLCBlcnJvcikKICAgICAgcmV0dXJuIG51bGwKICAgIH0KICB9CgpmdW5jdGlvbiBmaW5kSlNPTihzb3VyY2UsIHZhck5hbWUsIGJvZHksIGxlZnQsIHJpZ2h0LCBwcmVwZW5kSlNPTikgewogICAgbGV0IGpzb25TdHIgPSBiZXR3ZWVuKGJvZHksIGxlZnQsIHJpZ2h0KTsKICAgIGlmICghanNvblN0cikgewogICAgICB0aHJvdyBFcnJvcihgQ291bGQgbm90IGZpbmQgJHt2YXJOYW1lfSBpbiAke3NvdXJjZX1gKTsKICAgIH0KICAgIHJldHVybiBwYXJzZUpTT04oc291cmNlLCB2YXJOYW1lLCBjdXRBZnRlckpTT04oYCR7cHJlcGVuZEpTT059JHtqc29uU3RyfWApKTsKICB9OwogIAogIGJldHdlZW4gPSAoaGF5c3RhY2ssIGxlZnQsIHJpZ2h0KSA9PiB7CiAgICBsZXQgcG9zOwogICAgaWYgKGxlZnQgaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgY29uc3QgbWF0Y2ggPSBoYXlzdGFjay5tYXRjaChsZWZ0KTsKICAgICAgaWYgKCFtYXRjaCkgeyByZXR1cm4gJyc7IH0KICAgICAgcG9zID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBwb3MgPSBoYXlzdGFjay5pbmRleE9mKGxlZnQpOwogICAgICBpZiAocG9zID09PSAtMSkgeyByZXR1cm4gJyc7IH0KICAgICAgcG9zICs9IGxlZnQubGVuZ3RoOwogICAgfQogICAgaGF5c3RhY2sgPSBoYXlzdGFjay5zbGljZShwb3MpOwogICAgcG9zID0gaGF5c3RhY2suaW5kZXhPZihyaWdodCk7CiAgICBpZiAocG9zID09PSAtMSkgeyByZXR1cm4gJyc7IH0KICAgIGhheXN0YWNrID0gaGF5c3RhY2suc2xpY2UoMCwgcG9zKTsKICAgIHJldHVybiBoYXlzdGFjazsKICB9OwogIAogIGN1dEFmdGVySlNPTiA9IG1peGVkSnNvbiA9PiB7CiAgICBsZXQgb3BlbiwgY2xvc2U7CiAgICBpZiAobWl4ZWRKc29uWzBdID09PSAnWycpIHsKICAgICAgb3BlbiA9ICdbJzsKICAgICAgY2xvc2UgPSAnXSc7CiAgICB9IGVsc2UgaWYgKG1peGVkSnNvblswXSA9PT0gJ3snKSB7CiAgICAgIG9wZW4gPSAneyc7CiAgICAgIGNsb3NlID0gJ30nOwogICAgfQogIAogICAgaWYgKCFvcGVuKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgY3V0IHVuc3VwcG9ydGVkIEpTT04gKG5lZWQgdG8gYmVnaW4gd2l0aCBbIG9yIHsgKSBidXQgZ290OiAke21peGVkSnNvblswXX1gKTsKICAgIH0KICAKICAgIC8vIFN0YXRlcyBpZiB0aGUgbG9vcCBpcyBjdXJyZW50bHkgaW4gYSBzdHJpbmcKICAgIGxldCBpc1N0cmluZyA9IGZhbHNlOwogIAogICAgLy8gU3RhdGVzIGlmIHRoZSBjdXJyZW50IGNoYXJhY3RlciBpcyB0cmVhdGVkIGFzIGVzY2FwZWQgb3Igbm90CiAgICBsZXQgaXNFc2NhcGVkID0gZmFsc2U7CiAgCiAgICAvLyBDdXJyZW50IG9wZW4gYnJhY2tldHMgdG8gYmUgY2xvc2VkCiAgICBsZXQgY291bnRlciA9IDA7CiAgCiAgICBsZXQgaTsKICAgIGZvciAoaSA9IDA7IGkgPCBtaXhlZEpzb24ubGVuZ3RoOyBpKyspIHsKICAgICAgLy8gVG9nZ2xlIHRoZSBpc1N0cmluZyBib29sZWFuIHdoZW4gbGVhdmluZy9lbnRlcmluZyBzdHJpbmcKICAgICAgaWYgKG1peGVkSnNvbltpXSA9PT0gJyInICYmICFpc0VzY2FwZWQpIHsKICAgICAgICBpc1N0cmluZyA9ICFpc1N0cmluZzsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogIAogICAgICAvLyBUb2dnbGUgdGhlIGlzRXNjYXBlZCBib29sZWFuIGZvciBldmVyeSBiYWNrc2xhc2gKICAgICAgLy8gUmVzZXQgZm9yIGV2ZXJ5IHJlZ3VsYXIgY2hhcmFjdGVyCiAgICAgIGlzRXNjYXBlZCA9IG1peGVkSnNvbltpXSA9PT0gJ1xcJyAmJiAhaXNFc2NhcGVkOwogIAogICAgICBpZiAoaXNTdHJpbmcpIGNvbnRpbnVlOwogIAogICAgICBpZiAobWl4ZWRKc29uW2ldID09PSBvcGVuKSB7CiAgICAgICAgY291bnRlcisrOwogICAgICB9IGVsc2UgaWYgKG1peGVkSnNvbltpXSA9PT0gY2xvc2UpIHsKICAgICAgICBjb3VudGVyLS07CiAgICAgIH0KICAKICAgICAgLy8gQWxsIGJyYWNrZXRzIGhhdmUgYmVlbiBjbG9zZWQsIHRodXMgZW5kIG9mIEpTT04gaXMgcmVhY2hlZAogICAgICBpZiAoY291bnRlciA9PT0gMCkgewogICAgICAgIC8vIFJldHVybiB0aGUgY3V0IEpTT04KICAgICAgICByZXR1cm4gbWl4ZWRKc29uLnN1YnN0cigwLCBpICsgMSk7CiAgICAgIH0KICAgIH0KICAKICAgIC8vIFdlIHJhbiB0aHJvdWdoIHRoZSB3aG9sZSBzdHJpbmcgYW5kIGVuZGVkIHVwIHdpdGggYW4gdW5jbG9zZWQgYnJhY2tldAogICAgdGhyb3cgRXJyb3IoIkNhbid0IGN1dCB1bnN1cHBvcnRlZCBKU09OIChubyBtYXRjaGluZyBjbG9zaW5nIGJyYWNrZXQgZm91bmQpIik7CiAgfTsKICAKICBjb25zdCBqc29uQ2xvc2luZ0NoYXJzID0gL15bKVxdfSdcc10rLzsKICBmdW5jdGlvbiBwYXJzZUpTT04oc291cmNlLCB2YXJOYW1lLCBqc29uKSB7CiAgICBpZiAoIWpzb24gfHwgdHlwZW9mIGpzb24gPT09ICdvYmplY3QnKSB7CiAgICAgIHJldHVybiBqc29uOwogICAgfSBlbHNlIHsKICAgICAgdHJ5IHsKICAgICAgICBqc29uID0ganNvbi5yZXBsYWNlKGpzb25DbG9zaW5nQ2hhcnMsICcnKTsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShqc29uKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoYEVycm9yIHBhcnNpbmcgJHt2YXJOYW1lfSBpbiAke3NvdXJjZX06ICR7ZXJyLm1lc3NhZ2V9YCk7CiAgICAgIH0KICAgIH0KICB9Owo=",
  "javascript_search": "Y29uc3QgQkFTRV9VUkwgPSAnaHR0cHM6Ly9tLnlvdXR1YmUuY29tJzsKCnZhciBnbCA9ICJVUyIKdmFyIGhsID0gImVuIgoKZnVuY3Rpb24gZ2V0dXJsKGtleSwgdHlwZSkgewogICAgY29uc3QgaWQgPSBlbmNvZGVVUkkoa2V5KQogICAgbGV0IHVybAogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAvL3ZpZGVvcwogICAgICAgICAgICB1cmwgPSBgJHtCQVNFX1VSTH0vcmVzdWx0cz9zZWFyY2hfcXVlcnk9JHtpZH0mYXBwPWRlc2t0b3Amc3A9RWdJUUFRJTI1M0QlMjUzRGAKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAvL3BsYXlsaXN0CiAgICAgICAgICAgIHVybCA9IGAke0JBU0VfVVJMfS9yZXN1bHRzP3NlYXJjaF9xdWVyeT0ke2lkfSZhcHA9ZGVza3RvcCZzcD1FZ0lRQXclMjUzRCUyNTNEYAogICAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdXJsID0gYCR7QkFTRV9VUkx9L3Jlc3VsdHM/c2VhcmNoX3F1ZXJ5PSR7aWR9JmFwcD1kZXNrdG9wYAogICAgICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoaVBob25lOyBDUFUgaVBob25lIE9TIDEzXzFfMyBsaWtlIE1hYyBPUyBYKSBBcHBsZVdlYktpdC82MDUuMS4xNSAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vMTMuMC4xIE1vYmlsZS8xNUUxNDggU2FmYXJpLzYwNC4xJwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gcG9zdE1vcmUoKSB7CiAgICByZXR1cm4gewogICAgICAgIHVybDogYCR7QkFTRV9VUkx9L3lvdXR1YmVpL3YxL3NlYXJjaD9rZXk9QUl6YVN5QU9fRkoyU2xxVThRNFNURUhMR0NpbHdfWTlfMTFxY1c4YCwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChpUGhvbmU7IENQVSBpUGhvbmUgT1MgMTNfMV8zIGxpa2UgTWFjIE9TIFgpIEFwcGxlV2ViS2l0LzYwNS4xLjE1IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi8xMy4wLjEgTW9iaWxlLzE1RTE0OCBTYWZhcmkvNjA0LjEnLAogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iCiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBnZXRTZWFyY2hIVE1MUGFnZShib2R5LCBfZ2wsIF9obCkgewogICAgaWYgKF9nbCkgewogICAgICAgIGdsID0gX2dsLnRvVXBwZXJDYXNlKCkKICAgIH0KICAgIGlmIChfaGwpIHsKICAgICAgICBobCA9IF9obC50b0xvd2VyQ2FzZSgpCiAgICB9CiAgICBsZXQgZGF0YSA9IGZpbmRKU09OKCdzZWFyY2guaHRtbCcsICdzZWFyY2hfcmVzcG9uc2UnLCBib2R5LCAvXGJ5dEluaXRpYWxEYXRhXHMqPVxzKnsvLCAnPC9zY3JpcHQ+JywgJ3snKTsKICAgIHJldHVybiBnZXRTZWFyY2hKc29uKGRhdGEpCn0KCmZ1bmN0aW9uIGdldFNlYXJjaE1vcmVQYWdlKGJvZHkpIHsKICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShib2R5KTsKICAgIHJldHVybiBnZXRTZWFyY2hKc29uKGRhdGEpCn0KCgpmdW5jdGlvbiBmaW5kSlNPTihzb3VyY2UsIHZhck5hbWUsIGJvZHksIGxlZnQsIHJpZ2h0LCBwcmVwZW5kSlNPTikgewogICAgbGV0IGpzb25TdHIgPSBiZXR3ZWVuKGJvZHksIGxlZnQsIHJpZ2h0KTsKICAgIGlmICghanNvblN0cikgewogICAgICAgIHRocm93IEVycm9yKGBDb3VsZCBub3QgZmluZCAke3Zhck5hbWV9IGluICR7c291cmNlfWApOwogICAgfQogICAgbGV0IGN1dFN0cmluZyA9IGN1dEFmdGVySlNPTihgJHtwcmVwZW5kSlNPTn0ke2pzb25TdHJ9YCkKICAgIGlmICghY3V0U3RyaW5nKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoYEN1dFN0cmluZyAke3Zhck5hbWV9IGluICR7c291cmNlfWApOwogICAgfQogICAgcmV0dXJuIEpTT04ucGFyc2UoY3V0U3RyaW5nKTsKICAgIC8vIHJldHVybiBwYXJzZUpTT04oc291cmNlLCB2YXJOYW1lLCBjdXRBZnRlckpTT04oYCR7cHJlcGVuZEpTT059JHtqc29uU3RyfWApKTsKfTsKCmJldHdlZW4gPSAoaGF5c3RhY2ssIGxlZnQsIHJpZ2h0KSA9PiB7CiAgICB0cnkgewogICAgICAgIGxldCBwb3M7CiAgICAgICAgaWYgKGxlZnQgaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBoYXlzdGFjay5tYXRjaChsZWZ0KTsKICAgICAgICAgICAgaWYgKCFtYXRjaCkgeyByZXR1cm4gJyc7IH0KICAgICAgICAgICAgcG9zID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcG9zID0gaGF5c3RhY2suaW5kZXhPZihsZWZ0KTsKICAgICAgICAgICAgaWYgKHBvcyA9PT0gLTEpIHsgcmV0dXJuICcnOyB9CiAgICAgICAgICAgIHBvcyArPSBsZWZ0Lmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgaGF5c3RhY2sgPSBoYXlzdGFjay5zbGljZShwb3MpOwogICAgICAgIHBvcyA9IGhheXN0YWNrLmluZGV4T2YocmlnaHQpOwogICAgICAgIGlmIChwb3MgPT09IC0xKSB7IHJldHVybiAnJzsgfQogICAgICAgIGhheXN0YWNrID0gaGF5c3RhY2suc2xpY2UoMCwgcG9zKTsKICAgICAgICByZXR1cm4gaGF5c3RhY2s7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgYmV0d2VlbiA6ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgIH0KfTsKCmN1dEFmdGVySlNPTiA9IG1peGVkSnNvbiA9PiB7CiAgICB0cnkgewogICAgICAgIGxldCBvcGVuLCBjbG9zZTsKICAgICAgICBpZiAobWl4ZWRKc29uWzBdID09PSAnWycpIHsKICAgICAgICAgICAgb3BlbiA9ICdbJzsKICAgICAgICAgICAgY2xvc2UgPSAnXSc7CiAgICAgICAgfSBlbHNlIGlmIChtaXhlZEpzb25bMF0gPT09ICd7JykgewogICAgICAgICAgICBvcGVuID0gJ3snOwogICAgICAgICAgICBjbG9zZSA9ICd9JzsKICAgICAgICB9CgogICAgICAgIGlmICghb3BlbikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGN1dCB1bnN1cHBvcnRlZCBKU09OIChuZWVkIHRvIGJlZ2luIHdpdGggWyBvciB7ICkgYnV0IGdvdDogJHttaXhlZEpzb25bMF19YCk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdGF0ZXMgaWYgdGhlIGxvb3AgaXMgY3VycmVudGx5IGluIGEgc3RyaW5nCiAgICAgICAgbGV0IGlzU3RyaW5nID0gZmFsc2U7CgogICAgICAgIC8vIFN0YXRlcyBpZiB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaXMgdHJlYXRlZCBhcyBlc2NhcGVkIG9yIG5vdAogICAgICAgIGxldCBpc0VzY2FwZWQgPSBmYWxzZTsKCiAgICAgICAgLy8gQ3VycmVudCBvcGVuIGJyYWNrZXRzIHRvIGJlIGNsb3NlZAogICAgICAgIGxldCBjb3VudGVyID0gMDsKCiAgICAgICAgbGV0IGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IG1peGVkSnNvbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBUb2dnbGUgdGhlIGlzU3RyaW5nIGJvb2xlYW4gd2hlbiBsZWF2aW5nL2VudGVyaW5nIHN0cmluZwogICAgICAgICAgICBpZiAobWl4ZWRKc29uW2ldID09PSAnIicgJiYgIWlzRXNjYXBlZCkgewogICAgICAgICAgICAgICAgaXNTdHJpbmcgPSAhaXNTdHJpbmc7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVG9nZ2xlIHRoZSBpc0VzY2FwZWQgYm9vbGVhbiBmb3IgZXZlcnkgYmFja3NsYXNoCiAgICAgICAgICAgIC8vIFJlc2V0IGZvciBldmVyeSByZWd1bGFyIGNoYXJhY3RlcgogICAgICAgICAgICBpc0VzY2FwZWQgPSBtaXhlZEpzb25baV0gPT09ICdcXCcgJiYgIWlzRXNjYXBlZDsKCiAgICAgICAgICAgIGlmIChpc1N0cmluZykgY29udGludWU7CgogICAgICAgICAgICBpZiAobWl4ZWRKc29uW2ldID09PSBvcGVuKSB7CiAgICAgICAgICAgICAgICBjb3VudGVyKys7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWl4ZWRKc29uW2ldID09PSBjbG9zZSkgewogICAgICAgICAgICAgICAgY291bnRlci0tOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBbGwgYnJhY2tldHMgaGF2ZSBiZWVuIGNsb3NlZCwgdGh1cyBlbmQgb2YgSlNPTiBpcyByZWFjaGVkCiAgICAgICAgICAgIGlmIChjb3VudGVyID09PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGN1dCBKU09OCiAgICAgICAgICAgICAgICByZXR1cm4gbWl4ZWRKc29uLnN1YnN0cigwLCBpICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFdlIHJhbiB0aHJvdWdoIHRoZSB3aG9sZSBzdHJpbmcgYW5kIGVuZGVkIHVwIHdpdGggYW4gdW5jbG9zZWQgYnJhY2tldAogICAgICAgIHRocm93IEVycm9yKCJDYW4ndCBjdXQgdW5zdXBwb3J0ZWQgSlNPTiAobm8gbWF0Y2hpbmcgY2xvc2luZyBicmFja2V0IGZvdW5kKSIpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGN1dEFmdGVySlNPTiA6ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgIH0KfTsKCmNvbnN0IGpzb25DbG9zaW5nQ2hhcnMgPSAvXlspXF19J1xzXSsvOwpmdW5jdGlvbiBwYXJzZUpTT04oc291cmNlLCB2YXJOYW1lLCBqc29uKSB7CiAgICBpZiAoIWpzb24gfHwgdHlwZW9mIGpzb24gPT09ICdvYmplY3QnKSB7CiAgICAgICAgcmV0dXJuIGpzb247CiAgICB9IGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGpzb24gPSBqc29uLnJlcGxhY2UoanNvbkNsb3NpbmdDaGFycywgJycpOwogICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShqc29uKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoYEVycm9yIHBhcnNpbmcgJHt2YXJOYW1lfSBpbiAke3NvdXJjZX06ICR7ZXJyLm1lc3NhZ2V9YCk7CiAgICAgICAgfQogICAgfQp9OwoKZnVuY3Rpb24gZ2V0U2VhcmNoSnNvbihkYXRhKSB7CiAgICB2YXIgY29udGVudHMKICAgIGlmIChkYXRhLmNvbnRlbnRzKSB7CiAgICAgICAgY29udGVudHMgPSBkYXRhLmNvbnRlbnRzLnR3b0NvbHVtblNlYXJjaFJlc3VsdHNSZW5kZXJlci5wcmltYXJ5Q29udGVudHMKICAgICAgICAgICAgLnNlY3Rpb25MaXN0UmVuZGVyZXIuY29udGVudHM7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnRlbnRzID0gZGF0YS5vblJlc3BvbnNlUmVjZWl2ZWRDb21tYW5kc1swXS5hcHBlbmRDb250aW51YXRpb25JdGVtc0FjdGlvbi5jb250aW51YXRpb25JdGVtczsKICAgIH0KCiAgICB2YXIgcmVzdWx0ID0gW10KICAgIHZhciBjb250aW51YXRpb24gPSAiIgoKICAgIGNvbnRlbnRzLmZvckVhY2goY29udGVudCA9PiB7CiAgICAgICAgY29uc3QgaXRlbVNlY3Rpb25SZW5kZXJlciA9IGNvbnRlbnQuaXRlbVNlY3Rpb25SZW5kZXJlcgogICAgICAgIGlmIChpdGVtU2VjdGlvblJlbmRlcmVyKSB7CiAgICAgICAgICAgIGl0ZW1TZWN0aW9uUmVuZGVyZXIuY29udGVudHMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgIGxldCB2aWRlbyA9IHRvVmlkZW8oaXRlbSkKICAgICAgICAgICAgICAgIGlmICh2aWRlbykgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJhZGQgVmlkZW8iKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZpZGVvKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcGwgPSB0b1BsYXlsaXN0KGl0ZW0pCiAgICAgICAgICAgICAgICAgICAgaWYgKHBsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJhZGQgUGxheWxpc3QiKQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChwbCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjb250ZW50LmNvbnRpbnVhdGlvbkl0ZW1SZW5kZXJlcikgewogICAgICAgICAgICAgICAgY29udGludWF0aW9uID0gY29udGVudC5jb250aW51YXRpb25JdGVtUmVuZGVyZXIuY29udGludWF0aW9uRW5kcG9pbnQuY29udGludWF0aW9uQ29tbWFuZC50b2tlbgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CgogICAgY29uc3QganNvbkRhdGEgPSB7CiAgICAgICAgcmVzdWx0czogcmVzdWx0LAogICAgICAgIGNvdW50OiByZXN1bHQubGVuZ3RoLAogICAgICAgIHRva2VuOiB7CiAgICAgICAgICAgICJjb250ZXh0IjogewogICAgICAgICAgICAgICAgImNsaWVudCI6IHsKICAgICAgICAgICAgICAgICAgICAiaGwiOiBobCwKICAgICAgICAgICAgICAgICAgICAiZ2wiOiBnbCwKICAgICAgICAgICAgICAgICAgICAicmVtb3RlSG9zdCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJkZXZpY2VNYWtlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImRldmljZU1vZGVsIjogIiIsCiAgICAgICAgICAgICAgICAgICAgInZpc2l0b3JEYXRhIjogIiIsCiAgICAgICAgICAgICAgICAgICAgInVzZXJBZ2VudCI6ICJNb3ppbGxhLzUuMCAoTWFjaW50b3NoOyBJbnRlbCBNYWMgT1MgWCAxMF8xNV82KSBBcHBsZVdlYktpdC82MDUuMS4xNSAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vMTQuMC4zIFNhZmFyaS82MDUuMS4xNSIsCiAgICAgICAgICAgICAgICAgICAgImNsaWVudE5hbWUiOiAiV0VCIiwKICAgICAgICAgICAgICAgICAgICAiY2xpZW50VmVyc2lvbiI6ICIyLjIwMjEwNzIxLjAwLjAwIiwKICAgICAgICAgICAgICAgICAgICAib3NOYW1lIjogIldpbmRvd3MiLAogICAgICAgICAgICAgICAgICAgICJvc1ZlcnNpb24iOiAiMTAuMCIsCiAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsVXJsIjogIiIsCiAgICAgICAgICAgICAgICAgICAgInBsYXRmb3JtIjogIkRFU0tUT1AiLAogICAgICAgICAgICAgICAgICAgICJjbGllbnRGb3JtRmFjdG9yIjogIlVOS05PV05fRk9STV9GQUNUT1IiLAogICAgICAgICAgICAgICAgICAgICJicm93c2VyTmFtZSI6ICJDaHJvbWUiLAogICAgICAgICAgICAgICAgICAgICJicm93c2VyVmVyc2lvbiI6ICI3NC4wLjM3MjkuMTY5IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1c2VyIjogewogICAgICAgICAgICAgICAgICAgICJsb2NrZWRTYWZldHlNb2RlIjogImZhbHNlIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJyZXF1ZXN0IjogewogICAgICAgICAgICAgICAgICAgICJ1c2VTc2wiOiAidHJ1ZSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiY2xpY2tUcmFja2luZyI6IHsKICAgICAgICAgICAgICAgICAgICAiY2xpY2tUcmFja2luZ1BhcmFtcyI6ICJJaE1JdW9DaW5yYUE4Z0lWbEovQ0NoMzlmd3BTIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAiY29udGludWF0aW9uIjogY29udGludWF0aW9uCiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGpzb25EYXRhCn0KCgpmdW5jdGlvbiB0b1ZpZGVvKGl0ZW0pIHsKICAgIHRyeSB7CiAgICAgICAgdmFyIHZpZGVvUmVuZGVyZXIgPSBpdGVtLnZpZGVvUmVuZGVyZXIKICAgICAgICBpZiAodmlkZW9SZW5kZXJlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgdGl0bGUsCiAgICAgICAgICAgIGxvbmdCeWxpbmVUZXh0OiB7IHJ1bnMgfSwKICAgICAgICAgICAgdGh1bWJuYWlsLAogICAgICAgICAgICB2aWRlb0lkLAogICAgICAgICAgICBsZW5ndGhUZXh0OiB7IHNpbXBsZVRleHQ6IHRpbWUgfQogICAgICAgIH0gPSB2aWRlb1JlbmRlcmVyOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0eXBlOiAwLAogICAgICAgICAgICB0aXRsZTogdGl0bGUucnVuc1swXS50ZXh0LAogICAgICAgICAgICBkZXNjcmlwdGlvbjogcnVuc1swXSA/IHJ1bnNbMF0udGV4dCA6ICIiLAogICAgICAgICAgICBpbWFnZTogdGh1bWJuYWlsLnRodW1ibmFpbHMuc2xpY2UoLTEpWzBdLnVybCwKICAgICAgICAgICAgdmlkZW9JZCwKICAgICAgICAgICAgdGltZTogdGltZQogICAgICAgIH07CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKCJ0b1ZpZGVvIiwgZXJyb3IpCiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KfQoKZnVuY3Rpb24gdG9QbGF5bGlzdChpdGVtKSB7CiAgICB0cnkgewogICAgICAgIHZhciBwbCA9IGl0ZW0ucGxheWxpc3RSZW5kZXJlcgogICAgICAgIGlmIChwbCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgdGl0bGUsCiAgICAgICAgICAgIHZpZGVvQ291bnRUZXh0LAogICAgICAgICAgICB0aHVtYm5haWxzLAogICAgICAgICAgICB0aHVtYm5haWwsCiAgICAgICAgICAgIHBsYXlsaXN0SWQsCiAgICAgICAgICAgIHZpZGVvQ291bnRTaG9ydFRleHQsCiAgICAgICAgICAgIGxvbmdCeWxpbmVUZXh0CiAgICAgICAgfSA9IHBsOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6IDEsCiAgICAgICAgICAgIHRpdGxlOiB0aXRsZS5zaW1wbGVUZXh0LAogICAgICAgICAgICBpbWFnZTogdGh1bWJuYWlscyA/IHRodW1ibmFpbHNbMF0udGh1bWJuYWlscy5zbGljZSgtMSlbMF0udXJsIDogdGh1bWJuYWlsLnRodW1ibmFpbHMuc2xpY2UoLTEpWzBdLnVybCwKICAgICAgICAgICAgcGxheWxpc3RJZCwKICAgICAgICAgICAgY291bnQ6IHZpZGVvQ291bnRTaG9ydFRleHQgPyB2aWRlb0NvdW50U2hvcnRUZXh0LnJ1bnNbMF0udGV4dCA6IHZpZGVvQ291bnRUZXh0LnJ1bnNbMF0udGV4dCwKICAgICAgICAgICAgZGVzY3JpcHRpb246IGxvbmdCeWxpbmVUZXh0LnNpbXBsZVRleHQgPyBsb25nQnlsaW5lVGV4dC5zaW1wbGVUZXh0IDogbG9uZ0J5bGluZVRleHQucnVuc1swXS50ZXh0CiAgICAgICAgfTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coInRvUGxheWxpc3QiLCBlcnJvcikKICAgICAgICByZXR1cm4gbnVsbAogICAgfQp9Cg=="
}
